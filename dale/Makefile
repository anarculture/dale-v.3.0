.PHONY: help dev dev-frontend dev-backend stop test clean seed docs

help: ## Mostrar ayuda
	@echo "Dale - Makefile Commands"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

dev: ## Levantar frontend y backend
	@echo "ğŸš€ Levantando backend..."
	@cd infra && docker compose up -d
	@echo "âœ… Backend corriendo en http://localhost:8000"
	@echo ""
	@echo "ğŸš€ Levantando frontend..."
	@echo "âš ï¸  Ejecuta manualmente: cd frontend && npm run dev"
	@echo "   Frontend estarÃ¡ en http://localhost:3000"

dev-frontend: ## Solo frontend (host)
	@echo "ğŸš€ Levantando frontend..."
	@cd frontend && npm run dev

dev-backend: ## Solo backend (Docker)
	@echo "ğŸš€ Levantando backend..."
	@cd infra && docker compose up -d
	@echo "âœ… Backend corriendo en http://localhost:8000"
	@echo "ğŸ“ Logs: make logs-backend"

stop: ## Detener todos los servicios
	@echo "ğŸ›‘ Deteniendo servicios..."
	@cd infra && docker compose down
	@echo "âœ… Servicios detenidos"

logs-backend: ## Ver logs del backend
	@cd infra && docker compose logs -f backend

test: ## Ejecutar todos los tests
	@echo "ğŸ§ª Ejecutando tests del backend..."
	@cd backend && pytest
	@echo ""
	@echo "ğŸ§ª Ejecutando tests del frontend..."
	@cd frontend && npm run test:e2e

clean: ## Limpiar builds y dependencias
	@echo "ğŸ§¹ Limpiando..."
	@cd frontend && rm -rf .next node_modules
	@cd backend && rm -rf __pycache__ .pytest_cache
	@cd infra && docker compose down -v
	@echo "âœ… Limpieza completada"

seed: ## Cargar datos de ejemplo en la DB
	@echo "ğŸŒ± Cargando seeds..."
	@cd backend && docker exec -it dale-backend python scripts/seed.py
	@echo "âœ… Seeds cargados"

docs: ## Servir documentaciÃ³n MkDocs
	@echo "ğŸ“š Sirviendo documentaciÃ³n..."
	@cd docs && mkdocs serve

install-frontend: ## Instalar dependencias del frontend
	@echo "ğŸ“¦ Instalando dependencias del frontend..."
	@cd frontend && npm install

install-backend: ## Instalar dependencias del backend
	@echo "ğŸ“¦ Instalando dependencias del backend..."
	@cd backend && pip install -e ".[dev]"

migrate: ## Aplicar migraciones de Prisma
	@echo "ğŸ“Š Aplicando migraciones..."
	@cd backend && npx prisma migrate deploy
	@echo "âœ… Migraciones aplicadas"

migrate-dev: ## Crear y aplicar nueva migraciÃ³n (desarrollo)
	@echo "ğŸ“Š Creando migraciÃ³n..."
	@read -p "Nombre de la migraciÃ³n: " name; \
	cd backend && npx prisma migrate dev --name $$name

prisma-generate: ## Generar cliente Prisma
	@echo "ğŸ”„ Generando cliente Prisma..."
	@cd backend && npx prisma generate
	@echo "âœ… Cliente Prisma generado"
